"use strict";var style="<style>label.error{color: red; font-size: 15px}</style>",field={username:{required:!0,minlength:1,maxlength:30},password:{required:!0,minlength:5,maxlength:30},confimPassword:{required:!0,minlength:5,maxlength:30,equalTo:"#password"},date:{required:!0,dateISO:!0},text:{required:!1,maxlength:500},email:{maxlength:30,required:!1,email:!0},phoneNumber:{required:!0,digits:!0,minlength:11,maxlength:11},number:{required:!0,digits:!0},require:{required:!0}},Form={signinForm:{content:{account:field.username,permission:field.require,password:field.password,confimPassword:field.confimPassword},url:"/authentication/signin"},loginForm:{content:{account:field.username,password:field.password},url:"/authentication/login"},phoneForm:{content:{phoneNumber:field.phoneNumber,code:field.number},url:"/profile/validate_phone"},profileForm:{content:{nickname:field.username,sex:field.require,email:field.email,birthday:field.date,password:field.password,confimPassword:field.confimPassword},url:"/profile/change_info"},infoForm:{content:{info:field.text},url:"/profile/change_info"},codeSubmitForm:{content:{sign_code:field.number},url:"/attendance/register"},attendanceForm:{content:{sign_code:field.number},url:"/attendance/validate"},reAttendanceForm:{content:{account:field.username},url:"/attendance/resign"},groupForm:{content:{groupName:field.username,groupClass:field.require,groupInfo:field.text},url:"/group/register"},changeGroupForm:{content:{groupName:field.username,groupClass:field.require,groupInfo:field.text},url:"/group/change_group"},subscribeGroupForm:{content:{groupNumber:field.number},url:"/group/search"}},defaultErrorPlacement=function(e,r){r.parent().next().attr("id")===r.id+"-wrapper"||r.parent().after('<div id="'+r.id+'-wrapper" class="row"></div>'),e.appendTo(r.parent().next())},defaultAction=function(r){return function(e){302===e.status?location.href=e.location:r(e)}};$.fn.serializeJSON=function(){var e={},r=this.serializeArray();return $.each(r,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),JSON.stringify(e)},$.afterPOST=function(n){return function(r){return function(e){$.post(r,$(e).serializeArray(),defaultAction(n))}}},$(document).ready(function(){$("#signinForm").validate({rules:Form.signinForm.content,errorPlacement:defaultErrorPlacement,submitHandler:$.afterPOST(signinFormHandler)(Form.signinForm.url)}),$("#loginForm").validate({rules:Form.loginForm.content,errorPlacement:defaultErrorPlacement,submitHandler:$.afterPOST(loginFormHandler)(Form.loginForm.url)}),$("#phoneForm").validate({rules:Form.phoneForm.content,errorPlacement:defaultErrorPlacement,submitHandler:$.afterPOST(phoneFormHandler)(Form.phoneForm.url)}),$("#profileForm").validate({rules:Form.profileForm.content,errorPlacement:defaultErrorPlacement,submitHandler:$.afterPOST(profileFormHandler)(Form.profileForm.url)}),$("#attendanceForm").validate({rules:Form.attendanceForm.content,errorPlacement:defaultErrorPlacement,submitHandler:function(e){var r=$("#signName").text();$.post("/attendance/validate%3Fsign_name%3D"+r,$(e).serializeArray(),defaultAction(attendanceFormHandler))}}),$("#reAttendanceForm").validate({rules:Form.reAttendanceForm.content,errorPlacement:defaultErrorPlacement,submitHandler:$.afterPOST(reAttendanceFormHandler)(Form.attendanceForm.url)}),$("#infoForm").validate({rules:Form.infoForm.content,errorPlacement:defaultErrorPlacement,submitHandler:$.afterPOST(infoFormHandler)(Form.infoForm.url)}),$("#codeSubmitForm").validate({rules:Form.codeSubmitForm.content,errorPlacement:defaultErrorPlacement,submitHandler:function(e){var r=$(e).closest(".modal").attr("id"),n=r.slice(10),t=r.substring(6,7);$.post("/attendance/register%3Fclass%3D"+t+"%3Fid%3D"+n,$(e).serializeArray(),defaultAction(codeSubmitFormHandler))}}),$("#groupForm").validate({rules:Form.groupForm.content,errorPlacement:defaultErrorPlacement,submitHandler:$.afterPOST(groupFormHandler)(Form.groupForm.url)}),$("#changeGroupForm").validate({rules:Form.changeGroupForm.content,errorPlacement:defaultErrorPlacement,submitHandler:function(e){var r=$(".groupId").attr("id");$.post("/group/change_group%3Fgroup%3d"+r,$(e).serializeArray(),defaultAction(changeGroupFormHandler))}}),$("#subscribeGroup").validate({rules:Form.subscribeGroupForm.content,errorPlacement:defaultErrorPlacement,submitHandler:function(e){$.post(Form.subscribeGroupForm.url,$(e).serializeArray(),function(e){var r=$("#exist");r&&r.remove();var n=$('<ul id="exist"></ul>');e.found?e.groups.map(function(e){return $("<li><span>"+e+"</span></li>")}).forEach(function(e){return n.append(e)}):n.append($("<li>没有找到</li>"));$("#insert").after(n)})}}),$("title").append(style)});