{#
Params:

enumerate
day_courses: dict[course] -> key为小节号 1-14 14为网课
course.name
course.location

current_day: time -> 当前所在日期的时间

#}


{% extends "layouts/defaultLayout.html" %}
{% block navbar_content %}
    <li><a href="{{ url_for('schedule.toweek_course_') }}">本周课程</a></li>
    <li><a href="" id="dpcaller">日期</a></li>
{% endblock %}


{% block navbar_tabs %}
    <li class="tab"><a href="#course_offline">常规课程</a></li>
    <li class="tab"><a href="#course_online">线上课程</a></li>
{% endblock %}


{% block content %}
    <br>
    <div id="pick" class="container">
        <div id="course_offline" class="col s12">
            <blockquote>
                线下课程
            </blockquote>
            <ul class="collapsible popout" data-collapsible="accordion" id="collapsible_offline">
                {% for _i, sec in enumerate([Section(1),Section(4),Section(6),Section(8),Section(11)]) %}
                    {% if day_courses[sec.name] %}
                        <li>
                            <div class="collapsible-header">
                                <i class="material-icons">event</i>
                                第{{ (['一','二','三','四','五'])[_i] }}大节
                            </div>
                            <div class="collapsible-body">
                                {% for course in day_courses[sec.name] %}
                                    {{ course.name }}
                                    <br>
                                    {{ course.location }}
                                {% endfor %}
                            </div>
                        </li>
                    {% else %}
                        <li>
                            <div class="collapsible-header">
                                <i class="material-icons">event</i>
                                第{{ (['一','二','三','四','五'])[_i] }}大节
                            </div>
                            <div class="collapsible-body">
                                无
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
        <div id="course_online" class="col s12">
            <blockquote>
                线上课程
            </blockquote>
            <ul class="collapsible popout" data-collapsible="accordion" id="collapsible_online">
                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">event</i>
                            线上课程
                        </div>
                        <div class="collapsible-body">
                            {% for course in day_courses['online'] %}
                                {{ course.name }}
                                <br>
                                {{ course.location }}
                            {% endfor %}
                        </div>
                    </li>
                </ul>
        </div>
    </div>
{% endblock %}


{% block script_content %}
    <!--Color format-->
    <style>
        .picker__date-display {
            background-color: #ffab40;
        }

        .picker__day--selected, .picker__day--selected:hover, .picker--focused .picker__day--selected {
            background-color: #ffab40;
        }

        .picker__close, .picker__today, .picker__clear {
            color: #f57c00;
        }

        .picker__day.picker__day--today {
            color: #f57c00;
        }

        #datepicker {
            background-color: rgba(0, 0, 0, 0);
            border: none;
            /* border-bottom: 1px solid rgb(158, 158, 158); */
            border-radius: 0;
            outline: none;
            height: 3rem;
            width: 50%;
            font-size: 1rem;
            margin: 0 0 0 0;
            padding: 0;
            -webkit-box-shadow: none;
            box-shadow: none;
            -webkit-box-sizing: content-box;
            box-sizing: content-box;
            -webkit-transition: all 0.3s;
            transition: all 0.3s;
        }

        }

    </style>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.collapsible').collapsible();
            $("#collapsible_online").collapsible('open', 0);

            var s1 = (new Date()).setHours(10, 25);
            var s2 = (new Date()).setHours(12, 15);
            var s3 = (new Date()).setHours(15, 35);
            var s4 = (new Date()).setHours(17, 15);
            var nowTime = Date.now();
            if (nowTime <= s1)
                $("#collapsible_offline").collapsible('open', 0);
            else if (nowTime < s2)
                $("#collapsible_offline").collapsible('open', 1);
            else if (nowTime < s3)
                $("#collapsible_offline").collapsible('open', 2);
            else if (nowTime < s4)
                $("#collapsible_offline").collapsible('open', 3);
            else
                $("#collapsible_offline").collapsible('open', 4);

            var currYear = (new Date()).getFullYear();
            var opt = {};
            opt.date = {preset: 'date'};
            opt.default = {
                theme: 'material', //皮肤样式
                display: 'modal', //显示方式
                mode: 'scroller', //日期选择模式
                dateFormat: 'yyyy-mm-dd',
                lang: 'zh',
                showNow: true,
                nowText: "今天",
                startYear: currYear - 1, //开始年份
                endYear: currYear + 1, //结束年份
                onSelect: jumpToDate
            };
            $('#dpcaller').mobiscroll($.extend(opt['date'], opt['default']));

        });

        function jumpToDate(val, inst) {
            var _date = val.split('-');
            var _reURL = '/schedule/today_course%3Fyear%3D' + _date[0] + '%3Fmonth%3D' + _date[1] + '%3Fday%3D' + _date[2];
            window.location.href=_reURL;
        }
    </script>
{% endblock %}
